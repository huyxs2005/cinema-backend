<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vé đã bán - Cinema HUB Staff</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/styles.css}">
    <link rel="stylesheet" th:href="@{/staff/staff-ui.css}">
</head>
<body class="staff-theme page-surface">
<th:block th:replace="~{fragments/header :: main}"></th:block>

<main class="content-shell staff-shell">
    <section class="staff-container ticket-board" id="soldTicketsRoot"
             th:attr="data-base-endpoint=@{/api/staff/bookings}">
        <section class="staff-hero">
            <div>
                <p class="staff-eyebrow">Xuất vé</p>
                <h1>Vé đã xác thực</h1>
                <p>Danh sách vé đã bán thành công cho khách tại quầy.</p>
            </div>
            <div>
                <a class="btn btn-outline-light" th:href="@{/staff/pending-tickets}">Về danh sách chờ</a>
            </div>
        </section>

        <div th:if="${#lists.isEmpty(bookings)}" class="staff-empty-hint">
            Chưa có vé nào được xác thực.
        </div>

        <div class="ticket-card-grid" th:if="${!#lists.isEmpty(bookings)}">
            <article class="ticket-card ticket-card--sold"
                     th:each="booking : ${bookings}">
                <div class="ticket-card__head">
                    <div>
                        <p class="ticket-code" th:text="${booking.bookingCode}">BK-000000</p>
                        <p class="ticket-meta" th:text="'Thanh toán: ' + ${booking.paymentMethod ?: '---'}">Tiền mặt</p>
                    </div>
                    <div class="ticket-actions">
                        <button class="btn btn-primary btn-sm" data-action="print"
                                th:data-booking-code="${booking.bookingCode}">In vé</button>
                    </div>
                </div>
                <div class="ticket-card__body">
                    <p class="ticket-movie" th:text="${booking.movieTitle}">Tên phim</p>
                    <p class="ticket-room" th:text="'Phòng ' + ${booking.auditoriumName}">Phòng 1</p>
                    <p class="ticket-field">
                        <span>Suất:</span>
                        <strong th:text="${#temporals.format(booking.showtimeStart, 'HH:mm dd/MM/yyyy')}">12:00 01/01/2025</strong>
                    </p>
                    <p class="ticket-field">
                        <span>Ghế:</span>
                        <strong th:text="${#strings.listJoin(booking.seats.![seatLabel], ', ')}">A1, A2</strong>
                    </p>
                    <p class="ticket-field">
                        <span>Tổng tiền:</span>
                        <strong th:text="${#numbers.formatDecimal(booking.finalAmount != null ? booking.finalAmount : booking.totalAmount, 0, 'COMMA', 0, 'POINT') + ' ₫'}">0 ₫</strong>
                    </p>
                    <p class="ticket-field">
                        <span>Email:</span>
                        <strong th:text="${booking.customerEmail ?: '---'}">---</strong>
                    </p>
                    <p class="ticket-field">
                        <span>Điện thoại:</span>
                        <strong th:text="${booking.customerPhone ?: '---'}">---</strong>
                    </p>
                </div>
            </article>
        </div>
        <div class="staff-toast" id="staffTicketsToast" role="status"></div>
    </section>
</main>

<th:block th:replace="~{fragments/footer :: main}"></th:block>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script th:src="@{/auth.js}"></script>
<script th:src="@{/staff/staff-tickets.js}"></script>
</body>
</html>
